<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--부트스트랩-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../static/css/common.css">
    <script src="../static/js/common.js"></script>
    <script src="https://kit.fontawesome.com/447b429f54.js" crossorigin="anonymous"></script>
    <title>엄마의 부엌 | 주문확인</title>

    <script>
        /**
         * @brief 주문시 입력한 핸드폰번호로 해당 주문내역을 조회합니다.
         * @param {}
         * @returns {}
         * @author 김진회, 김도형
         */
        function showOrderList() {
            let phone = $('#phone1').val() + '-' + $('#phone2').val() + '-' + $('#phone3').val()

            let temp_html = ``;
            let temp_html2 = ``;
            $.ajax({
                type: "POST",
                url: "/orderlist/find",
                data: { 'phone': phone },
                success: function (response) {
                    //console.log(response)
                    const data = response['orderlist']
                    console.log(data)
                    for (let i = 0; i < data.length; i++) {
                        let data_name = data[i]['name']
                        let data_addr = data[i]['address']
                        let data_phone = data[i]['phone']
                        let data_listorder = data[i]['menu']
                        let data_priceall = data[i]['price']
                        let data_state = data[i]['state']
                        let data_today = data[i]['today']
                        let data_postmsg = data[i]['postmsg']
                        let data_deliverynum = data[i]['deliverynum']
                        let data_deliverycompany = data[i]['deliverycompany']

                        for (let a = 0; a < data_listorder.length; a++) {
                            temp_html2 += `

                                            <dl>
                                                <dt>
                                                    <div>
                                                        <h1>${data_listorder[a].split(',')[0]}</h1>
                                                        <span>주문수량 : ${data_listorder[a].split(',')[2]} 개</span>
                                                    </div>
                                                </dt>
                                            </dl>
                                        </div>
                                        <ul class="title">
                                            <li class="title_p">
                                                주문가격
                                            </li>
                                            <li>
                                                <span>
                                                    <span>${data_listorder[a].split(',')[1]}</span>

                                                    원</span>
                                            </li>
                                        </ul>

                                        `
                        }

                        temp_html += `
                                                <div class="order_inner">
                                        <div>
                                            <p>${data_name}</p>
                                            <p>${data_addr}</p>
                                            <p>${data_phone}</p>
                                        </div>
                                        <img src="../static/img/trash.png" style="width: 30px; height: 30px;"/>
                                        ${temp_html2}
                                        <p>
                                            <li>
                                                총 가격 : ${data_priceall}
                                            </li>            
                                            <li>
                                                입금현황 : ${data_state}
                                            </li>
                                            <li>
                                                배송현황 : 송장번호<a href="javascript:void(0);" onclick="showdelivery(this);" attr-a="${data_deliverycompany}" attr-b= "${data_deliverynum}">${data_deliverynum}</a>
                                                <a href="https://tracker.delivery/#/${data_deliverycompany}/${data_deliverynum}" target="_blank">배송조회</a>
                                            </li>
                                            <li id = ${data_deliverynum}>
                
                                            </li>
                                        </p>

                                
                                </div>
                            `;
                        temp_html2 = ``;

                    }
                    $("#orderTable").append(temp_html)
                }
            })
        }

        //배송추적 API  241560564195 kr.lotte
        function showdelivery(num) {
            console.log(num)
            console.log($(num).attr('attr-a'))
            console.log($(num).attr('attr-b'))
            let btag = $(num).attr('attr-b')
            
            $.ajax({
                type: "GET",
                url: "https://apis.tracker.delivery/carriers/"+$(num).attr('attr-a')+"/tracks/"+ 241560564195,
                data: {},
                success: function (response) {
                    let test = response['state']['text']
                    console.log(response)
                    console.log(test)
                    let temp_html = `${test}`
                    $("#"+btag).html(temp_html) 
                }
            })
        }

        //배송추적 API 택배회사 목록.
        function showdelivcom() {
            $.ajax({
                type: "GET",
                url: "https://apis.tracker.delivery/carriers",
                data: {},
                success: function (response) {
                    let test = response['message']
                    console.log(response)
                }
            })
        }

        $(document).ready(function () {
            showdelivcom();
        });
    </script>
</head>

<body class="bodycs">
    <header w3-include-html="header.html"></header>

    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <label class="input-group-text">전화번호 </label>
        </div>
        <select class="custom-select" id="phone1">
            <option value="010" selected>010</option>
            <option value="011">011</option>
            <option value="016">016</option>
            <option value="017">017</option>
            <option value="018">018</option>
            <option value="019">019</option>
        </select>
        -
        <input type='tel' class="form-control" id="phone2" maxlength="4">
        -
        <input type='tel' class="form-control" id="phone3" maxlength="4">
        <button onclick="showOrderList()">조회</button>
    </div>
    <div id="orderDiv">
        <div class="order_inner">
            <div>
                <p>이름</p>
                <p>주소</p>
                <p>번호</p>
            </div>
            <img src="../static/img/trash.png" style="width: 30px; height: 30px;" />
            <dl>
                <dt>
                    <div>
                        <h1>감자조림(test)</h1>
                        <span>주문수량 : 10 개</span>
                    </div>
                </dt>
            </dl>
        </div>
        <ul class="title">
            <li class="title_p">
                주문가격
            </li>
            <li>
                <span>
                    <span>100000</span>

                    원</span>
            </li>
        </ul>
        <p>
            <li>
                총 가격 얼마
            </li>
            <li>
                입금현황 : 대기대기대기
            </li>
            <li>
                <!-- 버튼 호출 -->
                <!-- <button type="button" value = "241560564195" onclick = showdelivery(+this.value) >241560564195</button> -->
                배송현황 :
                송장번호<a href="javascript:void(0);" onclick="showdelivery(this);" attr-a="test">241560564195</a>
                
            </li>
            <li id = test>
                
            </li>
        </p>


    </div>
    <table id="orderTable">

    </table>

    <footer w3-include-html="footer.html"></footer>
    <script>
        includeHTML();
    </script>
</body>

</html>